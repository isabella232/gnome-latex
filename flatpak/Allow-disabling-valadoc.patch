diff -ruN vala-0.40.8.old/configure.ac vala-0.40.8/configure.ac
--- vala-0.40.8.old/configure.ac	2018-07-16 12:32:40.000000000 +0100
+++ vala-0.40.8/configure.ac	2018-08-01 10:23:36.977684625 +0100
@@ -112,35 +112,37 @@
 AC_SUBST(GMODULE_CFLAGS)
 AC_SUBST(GMODULE_LIBS)
 
-PKG_CHECK_MODULES(LIBGVC, libgvc >= $LIBGVC_REQUIRED)
-AC_MSG_CHECKING([for CGRAPH])
-cgraph_tmp_LIBADD="$LIBADD"
-cgraph_tmp_CFLAGS="$CFLAGS"
-LIBADD="$LIBADD $LIBGVC_LIBS"
-CFLAGS="$CFLAGS $LIBGVC_CFLAGS"
-AC_RUN_IFELSE(
-	[AC_LANG_SOURCE([
-		#include <gvc.h>
-
-		int main(void) {
-			#ifdef WITH_CGRAPH
-				return 0;
-			#else
-				return -1;
-			#endif
-		}
-	])], [
-		AC_MSG_RESULT([yes])
-		VALAFLAGS="$VALAFLAGS -D WITH_CGRAPH"
-		have_cgraph=yes
-	], [
-		AC_MSG_RESULT([no])
-		have_cgraph=no
-	]
-)
-LIBADD="$cgraph_tmp_LIBADD"
-CFLAGS="$cgraph_tmp_CFLAGS"
-AM_CONDITIONAL(HAVE_CGRAPH, test "$have_cgraph" = "yes")
+AC_ARG_ENABLE(valadoc, AS_HELP_STRING([--disable-valadoc], [Disable valadoc]), enable_valadoc=$enableval, enable_valadoc=yes)
+if test x$enable_valadoc = xyes; then
+	PKG_CHECK_MODULES(LIBGVC, libgvc >= $LIBGVC_REQUIRED)
+	AC_MSG_CHECKING([for CGRAPH])
+	cgraph_tmp_LIBADD="$LIBADD"
+	cgraph_tmp_CFLAGS="$CFLAGS"
+	LIBADD="$LIBADD $LIBGVC_LIBS"
+	CFLAGS="$CFLAGS $LIBGVC_CFLAGS"
+	AC_RUN_IFELSE(
+		[AC_LANG_SOURCE([
+			#include <gvc.h>
+			int main(void) {
+				#ifdef WITH_CGRAPH
+					return 0;
+				#else
+					return -1;
+				#endif
+			}
+		])], [
+			AC_MSG_RESULT([yes])
+			VALAFLAGS="$VALAFLAGS -D WITH_CGRAPH"
+			have_cgraph=yes
+		], [
+			AC_MSG_RESULT([no])
+			have_cgraph=no
+		]
+	)
+	LIBADD="$cgraph_tmp_LIBADD"
+	CFLAGS="$cgraph_tmp_CFLAGS"
+fi
+AM_CONDITIONAL(ENABLE_VALADOC, test x$enable_valadoc = xyes)
 
 AC_PATH_PROG([XSLTPROC], [xsltproc], :)
 AM_CONDITIONAL(HAVE_XSLTPROC, test "$XSLTPROC" != :)

diff -ruN vala-0.40.8.old/doc/Makefile.am vala-0.40.8/doc/Makefile.am
--- vala-0.40.8.old/doc/Makefile.am	2018-07-12 13:08:31.000000000 +0100
+++ vala-0.40.8/doc/Makefile.am	2018-08-01 10:31:02.440288711 +0100
@@ -6,7 +6,6 @@
 
 dist_man_MANS = \
 	valac.1 \
-	valadoc.1 \
 	vala-gen-introspect.1 \
 	vapigen.1 \
 	$(NULL)
@@ -19,7 +18,11 @@
 	$(NULL)
 
 if HAVE_HELP2MAN
+if ENABLE_VALADOC
 manpages: valac.1 valadoc.1 vala-gen-introspect.1 vapigen.1
+else
+manpages: valac.1 vala-gen-introspect.1 vapigen.1
+endif
 	@rm $^
 	$(MAKE) $(AM_MAKEFLAGS) $^
 
@@ -49,7 +52,9 @@
 if ENABLE_UNVERSIONED
 install-data-hook:
 	cd $(DESTDIR)$(man1dir) && $(LN_S) -f valac@PACKAGE_SUFFIX@.1 valac.1
+if ENABLE_VALADOC
 	cd $(DESTDIR)$(man1dir) && $(LN_S) -f valadoc@PACKAGE_SUFFIX@.1 valadoc.1
+endif
 	cd $(DESTDIR)$(man1dir) && $(LN_S) -f vala-gen-introspect@PACKAGE_SUFFIX@.1 vala-gen-introspect.1
 	cd $(DESTDIR)$(man1dir) && $(LN_S) -f vapigen@PACKAGE_SUFFIX@.1 vapigen.1
 endif
@@ -70,7 +75,7 @@
 	--basedir=internal-apis/ \
 	$(NULL)
 
-if HAVE_CGRAPH
+if ENABLE_VALADOC
 COMMON_VALADOCFLAGS += -D WITH_CGRAPH
 endif
 
diff -ruN vala-0.40.8.old/Makefile.am vala-0.40.8/Makefile.am
--- vala-0.40.8.old/Makefile.am	2018-07-16 07:15:16.000000000 +0100
+++ vala-0.40.8/Makefile.am	2018-08-01 10:23:36.977684625 +0100
@@ -13,9 +13,19 @@
 	doc \
 	gobject-introspection \
 	vapigen \
+	$(NULL)
+
+if ENABLE_VALADOC
+SUBDIRS += \
 	libvaladoc \
 	valadoc \
 	$(NULL)
+endif
+
+DISTCHECK_CONFIGURE_FLAGS = \
+	--enable-valadoc \
+	--enable-unversioned \
+	$(NULL)
 
 if ENABLE_UNVERSIONED
 aclocaldir = $(datadir)/aclocal

